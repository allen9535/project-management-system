name: EC2 CD

on:
    pull_request:
        branches: ['main']

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Deploy to EC2 too
              env:
                  EC2_PRIVATE_KEY: ${{ secrets.EC2_PRIVATE_KEY }}
                  EC2_HOST: ${{ secrets.EC2_HOST }}
                  EC2_USER_NAME: ${{ secrets.EC2_USER_NAME }}
              run: echo "$PRIVATE_KEY" > private_key && chmod 600 private_key
                  ssh -o StrictHostKeyChecking=no -i private_key ${EC2_USER_NAME}@${EC2_HOST} '
                  cd /project-management &&
                  git checkout main &&
                  git fetch --all &&
                  git reset --hard origin/main &&
                  git pull origin main'
